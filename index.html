<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Bandit by purzelrakete</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Bandit</h1>
        <p>A mulitarmed bandit to A/B test go projects, or other languages via an HTTP API. It uses a log based data flow. Based on John Myles Whites' book &quot;Bandit Algorithms for Website Optimization&quot;</p>

        <p class="view"><a href="https://github.com/purzelrakete/bandit">View the Project on GitHub <small>purzelrakete/bandit</small></a></p>


        <ul>
          <li><a href="https://github.com/purzelrakete/bandit/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/purzelrakete/bandit/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/purzelrakete/bandit">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <p><a href="https://travis-ci.org/purzelrakete/bandit"><img src="https://travis-ci.org/purzelrakete/bandit.png?branch=master" alt="Build Status"></a>
<a href="https://coveralls.io/r/purzelrakete/bandit"><img src="https://coveralls.io/repos/purzelrakete/bandit/badge.png" alt="Coverage Status"></a></p>

<p>A mulitarmed bandit to A/B test go projects, or other languages via an HTTP API.
It uses a log-based data flow.
Based on John Myles White's <a href="http://shop.oreilly.com/product/0636920027393.do">Bandit Algorithms for Website Optimization</a>.
Full documentation is available <a href="http://godoc.org/github.com/purzelrakete/bandit">on godoc</a>.</p>

<p>You can see a general introduction to <a href="http://goo.gl/wQkSga" title="Multiarmed Bandits">Multiarmed Bandits</a> here.</p>

<p>Build bandit with <code>make</code>. You need go &gt;= 1.1.1..</p>

<h2>
<a name="data-flow" class="anchor" href="#data-flow"><span class="octicon octicon-link"></span></a>Data Flow</h2>

<p>A bandit instance is embedded into e.g. an HTTP server. Incoming requests select
a variant from an experiment, and then log that selection. Subsequent positive
feedback from that selection, e.g. a click, is also logged.</p>

<p>Periodically, <code>bandit-job</code> aggregates selections and rewards from the logs, re-
calculates variant distribution, and emits a snapshot file to some  shared
storage. The bandit polls for updates to that snapshot file and hot-reloads the
distribution on change.</p>

<pre><code>+----------+           +----------+                +------------+
| Bandit   |--select--&gt;| Log      |- - periodic - &gt;| bandit-job |
| instance |--reward--&gt;| storage  |                |            |
+----------+           +----------+                +------------+
     ^                                                    |
     |                 +----------+                       |
     '---------poll----| Snapshot |&lt;----------------------'
                       +----------+
</code></pre>

<p><code>bandit-job</code> expects log lines in the following format:</p>

<pre><code>1379257984 BanditSelection shape-20130822:1
1379257987 BanditReward shape-20130822:1 0.000000
</code></pre>

<p>Notice that the reward line includes the variant tag. It is up to you to
transport this tag through your system.</p>

<h2>
<a name="types" class="anchor" href="#types"><span class="octicon octicon-link"></span></a>Types</h2>

<p>A Bandit is used to select arms and update arms with reward information:</p>

<div class="highlight highlight-go"><pre><span class="kd">type</span> <span class="nx">Bandit</span> <span class="kd">interface</span> <span class="p">{</span>
  <span class="nx">SelectArm</span><span class="p">()</span> <span class="kt">int</span>
  <span class="nx">Update</span><span class="p">(</span><span class="nx">arm</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">reward</span> <span class="kt">float64</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>

<p>You will probably not use bandits directly. Instead, a Bandit is put to work
inside an Experiment. You set up experiments (e.g. signup form buttons) with as
many variants as you like (e.g. blue button, red button):</p>

<pre><code>  +--------+            +---------------+      periodic job
  | Bandit | 1 &lt;----- 1 | Snapshot file | &lt;--- aggregates logs
  +--------+            +---------------+      into counters
      1
      ^
      |
      1
+------------+         +---------+
| Experiment | 1 --&gt; * | Variant |
|------------|         |---------|
| name       |         | tag     |
+------------+         | url     |
                       +---------+
</code></pre>

<h2>
<a name="integrating-and-running-experiments" class="anchor" href="#integrating-and-running-experiments"><span class="octicon octicon-link"></span></a>Integrating and running experiments</h2>

<p>To use a bandit, you first have to define an experiment and its variants. This
is currently configured as a TSV with a name, URL, and tag. See experiments.tsv
for an example.</p>

<p>Choose the best integration for your project depending on whether you have
a client side javascript application, a go project, or a project in some other
language.</p>

<h3>
<a name="integration-with-javascript-and-the-http-api" class="anchor" href="#integration-with-javascript-and-the-http-api"><span class="octicon octicon-link"></span></a>Integration with Javascript and the HTTP API</h3>

<p>Run <code>bandit-api -port 80 -apiExperiments experiments.tsv</code> to start the
endpoint with the provided test experiments.</p>

<p>In this scenario, the application makes a request to the API endpoint and
then a second request to your API.</p>

<pre><code>             Bandit HTTP API
Javascript   Select   Reward   Your API
----------   ------   ------   --------
     |--------&gt;|                  |
     |&lt;--------|                  |
     |                            |
     |---------------------------&gt;|
     |&lt;---------------------------|
     :
   later
     :
     |-----------------&gt;|
     |&lt;-----------------|
</code></pre>

<p>Get a variant from the HTTP API first:</p>

<pre><code>GET https://api/experiements/widgets?uid=11 HTTP/1.0
</code></pre>

<p>The API responds with a variant:</p>

<pre><code>HTTP/1.0 200 OK
Content-Type: text/json

{
  uid: 11,
  experiment: "widgets",
  url: "https://api/widget?color=blue"
  tag: "widget-sauce-flf89"
}
</code></pre>

<p>The client can now follow up with a request to the returned widget:</p>

<pre><code>GET https://api/widget?color=blue HTTP/1.0
</code></pre>

<p>See the exampe binary and example/index.html for a running example.</p>

<h3>
<a name="integration-in-another-language-using-the-http-api" class="anchor" href="#integration-in-another-language-using-the-http-api"><span class="octicon octicon-link"></span></a>Integration in another language using the HTTP API</h3>

<p>Launch the HTTP API as above. When you get a request to your endpoint, make
a backend request to the HTTP API. Use the returned variant to vary.</p>

<h3>
<a name="integration-with-go-projects" class="anchor" href="#integration-with-go-projects"><span class="octicon octicon-link"></span></a>Integration with Go projects</h3>

<p>First, load an experiment.</p>

<div class="highlight highlight-go"><pre>
<span class="nx">experiments</span> <span class="o">:=</span> <span class="nx">bandit</span><span class="p">.</span><span class="nx">NewFileOpener</span><span class="p">(</span><span class="s">"experiments.tsv"</span><span class="p">)</span>
<span class="nx">e</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">bandit</span><span class="p">.</span><span class="nx">NewExperiment</span><span class="p">(</span><span class="nx">experiments</span><span class="p">,</span> <span class="s">"shape-20130822"</span><span class="p">)</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
  <span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">"could not construct experiment: %s"</span><span class="p">,</span> <span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">())</span>
<span class="p">}</span>

<span class="nx">snapshot</span> <span class="o">:=</span> <span class="nx">bandit</span><span class="p">.</span><span class="nx">NewFileOpener</span><span class="p">(</span><span class="s">"shape-20130822.tsv"</span><span class="p">)</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">InitDelayedBandit</span><span class="p">(</span><span class="nx">snapshot</span><span class="p">,</span> <span class="mi">3</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Hours</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
  <span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">"could initialize bandits: %s"</span><span class="p">,</span> <span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">())</span>
<span class="p">}</span>

<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">Variants</span><span class="p">)</span>
</pre></div>

<p>Initialize your own variant code if necessary. Then, serve. In each request,
select a variant via the experiment and serve it. Be sure to include the tag
in the response, so your clients can pass it back with rewards.</p>

<h1>
<a name="miscellaneous-information" class="anchor" href="#miscellaneous-information"><span class="octicon octicon-link"></span></a>Miscellaneous information</h1>

<h2>
<a name="aggregating-logs" class="anchor" href="#aggregating-logs"><span class="octicon octicon-link"></span></a>Aggregating Logs</h2>

<p>In a production setting logs are aggregated as described in Data Flow. You
can use <code>bandit-job</code> as a streaming map reduce job with <code>bandit-job -kind map</code>
and <code>bandit-job -kind reduce</code>. You can also run over the logs wiht <code>bandit-job
-kind poll</code>. See <code>bandit-job -h</code> for information.</p>

<h2>
<a name="bandit-algorithms" class="anchor" href="#bandit-algorithms"><span class="octicon octicon-link"></span></a>Bandit Algorithms</h2>

<p>You can currently choose between Epsilon Greedy, UCB1 and Softmax. See the
godoc for detailed information.</p>

<h2>
<a name="simulation" class="anchor" href="#simulation"><span class="octicon octicon-link"></span></a>Simulation</h2>

<p>The <code>bandit/sim</code> package includes the facility to simulate and plot
experiemnts. You should run your own simulations before putting experiments
into production. See the sim package for details. You can run bandit-plot
to see some out of the box simulations.</p>

<h1>
<a name="status" class="anchor" href="#status"><span class="octicon octicon-link"></span></a>Status</h1>

<p>Version: 0.0.0-alpha.1</p>

<p>The API is currently <em>not stable</em> and is subject to change at any time.</p>

<h2>
<a name="todo" class="anchor" href="#todo"><span class="octicon octicon-link"></span></a>TODO</h2>

<ul>
<li>UCB with extensions for delayed rewards</li>
<li>Sticky assignements</li>
</ul><h1>
<a name="credits" class="anchor" href="#credits"><span class="octicon octicon-link"></span></a>Credits</h1>

<p>Developed by</p>

<ul>
<li>Rany Keddo (<a href="https://github.com/purzelrakete" class="user-mention">@purzelrakete</a>)</li>
</ul><p>Thanks to for advice and opinions to</p>

<ul>
<li>John Myles White</li>
<li>Josh Devins</li>
<li>Ozg√ºr Demir</li>
<li>Peter Bourgon</li>
<li>Sean Braithwaite</li>
</ul>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/purzelrakete">purzelrakete</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>