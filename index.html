<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Bandit by purzelrakete</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Bandit</h1>
        <h2>A mulitarmed bandit to A/B test go projects, or other languages via an HTTP API. It uses a log based data flow. Based on John Myles Whites' book &quot;Bandit Algorithms for Website Optimization&quot;</h2>
        <a href="https://github.com/purzelrakete/bandit" class="button"><small>View project on</small>GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <p>A mulitarmed bandit to A/B test go projects, or other languages via an HTTP
API. It uses a log based data flow. Based on John Myles White's <a href="http://shop.oreilly.com/product/0636920027393.do">Bandit
Algorithms for Website
Optimization</a>. Full
documentation is available <a href="http://godoc.org/github.com/purzelrakete/bandit">on
godoc</a>.</p>

<p>Build bandit with <code>make</code>. You need &gt;= go 1.1.1..</p>

<h2>
<a name="try-bandit" class="anchor" href="#try-bandit"><span class="octicon octicon-link"></span></a>Try Bandit</h2>

<p><code>bandit-example</code> runs a toy demonstration of the HTTP API which you can see at
http://localhost:8080:</p>

<p><img src="http://goo.gl/oaCF3o" alt="example"></p>

<h2>
<a name="data-flow" class="anchor" href="#data-flow"><span class="octicon octicon-link"></span></a>Data Flow</h2>

<p>Bandit operates a delayed bandit with log data. This means that reward data
(ie clickthroughs) do not reach the bandit in real time. Instead they are
aggregated into snapshots by bandit-job. Each bandit instance then polls for
this snapshot periodically.</p>

<pre><code>              select
  bandit     -----&gt;       log       ---&gt;  bandit-job
  instance    reward      storage         perodically writes
    ^        -----&gt;                            |
    |                                          |
    .-----------------  snapshot &lt;-------------.
        bandit polls
</code></pre>

<p><code>bandit-job</code> expects log lines in the following format:</p>

<pre><code>1379257984 BanditSelection shape-20130822:1
1379257987 BanditReward shape-20130822:1 0.000000
</code></pre>

<p>Notice that the reward line includes the variant Tag. It is up to you to
transport this tag through your system.</p>

<h2>
<a name="types" class="anchor" href="#types"><span class="octicon octicon-link"></span></a>Types</h2>

<p>A Bandit is used to select arms and update arms with reward information:</p>

<div class="highlight highlight-go"><pre><span class="kd">type</span> <span class="nx">Bandit</span> <span class="kd">interface</span> <span class="p">{</span>
  <span class="nx">SelectArm</span><span class="p">()</span> <span class="kt">int</span>
  <span class="nx">Update</span><span class="p">(</span><span class="nx">arm</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">reward</span> <span class="kt">float64</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>

<p>You will probably not use bandits directly. Instead, a Bandit is put to work
inside an Experiment. You set up experiments (ie signup form buttons) with as
many variants as you like (ie blue button, red button):</p>

<pre><code>                          .------------.
       .--------.         |  snapshot  |       periodic job
       | Bandit | &lt;------ |    file    | &lt;---  aggregates logs
       .--------.         .------------.       into counters
           ^
           |
      .------------.       .----------.
      | Experiment | --*-&gt; |  Variant |
      .------------.       .----------.
      | name       |       | tag      |
      .------------.       | url      |
                           .----------.
</code></pre>

<h2>
<a name="running-experiments" class="anchor" href="#running-experiments"><span class="octicon octicon-link"></span></a>Running experiments</h2>

<p>To use a bandit, you first have to define an experiment and it's variants.
This is currently configured as a TSV with name, url, tag. See experiments.tsv
for an example.</p>

<p>Choose the best integration for your project depending on whether you have
a client side javascript application, a go project, or a project in some other
language.</p>

<h3>
<a name="javascript-and-the-http-api" class="anchor" href="#javascript-and-the-http-api"><span class="octicon octicon-link"></span></a>Javascript and the HTTP API</h3>

<p>Run <code>bandit-api -port 80 -apiExperiments experiments.tsv</code> to start the
endpoint with the provided test experiments.</p>

<p>In this scenario, the application makes a request to the api endpoint and
then a second request to your api.</p>

<pre><code>   .--------------.        .--------------------------.
   |  javascript  | -----&gt; | bandit HTTP API (select) |
   .--------------.        .--------------------------.
          |                .------------.
          ---------------&gt; |  your API  |
          |                .------------.
          |                .---------------------------.
          ---------------&gt; |  bandit HTTP API (reward) |
                           .---------------------------.
</code></pre>

<p>Get a variant from the HTTP API first:</p>

<pre><code>GET https://api/experiements/widgets?uid=11 HTTP/1.0
</code></pre>

<p>The API responds with a variant:</p>

<pre><code>HTTP/1.0 200 OK
Content-Type: text/json

{
  uid: 11,
  experiment: "widgets",
  url: "https://api/widget?color=blue"
  tag: "widget-sauce-flf89"
}
</code></pre>

<p>The client can now follow up with a request to the returned widget:</p>

<pre><code>GET https://api/widget?color=blue HTTP/1.0
</code></pre>

<p>See the exampe binary and example/index.html for a running example of this.</p>

<h3>
<a name="project-in-another-language-using-the-http-api" class="anchor" href="#project-in-another-language-using-the-http-api"><span class="octicon octicon-link"></span></a>Project in another language using the HTTP API</h3>

<p>Launch the HTTP API as above. When you get a request to your endpoint, make
a backend request to the HTTP API. Use the returned variant to vary.</p>

<h3>
<a name="running-experiments-in-go-with-the-bandit-library" class="anchor" href="#running-experiments-in-go-with-the-bandit-library"><span class="octicon octicon-link"></span></a>Running experiments in go with the bandit library</h3>

<p>Integrate with as follows:</p>

<ol>
<li>Load an experiment.</li>
<li>Initialize your own variant code if necessary.</li>
<li>Serve. In each request, select a variant with the experiment and serve it.</li>
</ol><p>You can load an experiment with an associated bandit as an Experiment:</p>

<div class="highlight highlight-go"><pre><span class="nx">es</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">bandit</span><span class="p">.</span><span class="nx">NewExperiments</span><span class="p">(</span><span class="o">*</span><span class="nx">apiExperiments</span><span class="p">)</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
  <span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">"could not construct experiments: %s"</span><span class="p">,</span> <span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">())</span>
<span class="p">}</span>

<span class="nx">opener</span> <span class="o">:=</span> <span class="nx">bandit</span><span class="p">.</span><span class="nx">NewFileOpener</span><span class="p">(</span><span class="o">*</span><span class="nx">apiSnapshot</span><span class="p">)</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">es</span><span class="p">.</span><span class="nx">InitDelayedBandit</span><span class="p">(</span><span class="nx">opener</span><span class="p">,</span> <span class="o">*</span><span class="nx">apiSnaphotPoll</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
  <span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">"could initialize bandits: %s"</span><span class="p">,</span> <span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">())</span>
<span class="p">}</span>

<span class="nx">m</span> <span class="o">:=</span> <span class="nx">pat</span><span class="p">.</span><span class="nx">New</span><span class="p">()</span>
<span class="nx">m</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="s">"/experiments/:name"</span><span class="p">,</span> <span class="nx">http</span><span class="p">.</span><span class="nx">HandlerFunc</span><span class="p">(</span><span class="nx">bhttp</span><span class="p">.</span><span class="nx">SelectionHandler</span><span class="p">(</span><span class="nx">es</span><span class="p">,</span> <span class="o">*</span><span class="nx">apiPinTTL</span><span class="p">)))</span>
<span class="nx">http</span><span class="p">.</span><span class="nx">Handle</span><span class="p">(</span><span class="s">"/"</span><span class="p">,</span> <span class="nx">m</span><span class="p">)</span>

<span class="c1">// serve</span>
<span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="o">*</span><span class="nx">apiBind</span><span class="p">,</span> <span class="kc">nil</span><span class="p">))</span>
</pre></div>

<p>You can iterate over available Variants in your endpoint setup via
t.Experiment.Variants. Use this to intialize your viariants, or just switch:</p>

<pre><code>var msg string
switch t.Select().Tag {
  case "shape-20130822:1":
    msg = "hello square"
  case "shape-20130822:2":
    msg = "hello circle"
}
</code></pre>

<p>Your response must include the Tag somwhere so the client can tag subsequent
rewards. If you do not do this, you will not be able to calculate rewards.</p>

<h2>
<a name="bandit-algorithms" class="anchor" href="#bandit-algorithms"><span class="octicon octicon-link"></span></a>Bandit Algorithms</h2>

<p>You can currently choose between Epsilon Greedy, UCB1 and Softmax. See the
godoc for detailed information.</p>

<h2>
<a name="simulation" class="anchor" href="#simulation"><span class="octicon octicon-link"></span></a>Simulation</h2>

<p>The <code>bandit/sim</code> package includes the facility to simulate and plot
experiemnts. You should run your own simulations before putting experiments
into production. See the sim package for details. You can run bandit-plot
to see some out of the box simulations.</p>

<h1>
<a name="status" class="anchor" href="#status"><span class="octicon octicon-link"></span></a>Status</h1>

<p>Version: 0.0.0-alpha.1</p>

<p>The API is currently <em>not stable</em> and is subject to change at any time.</p>

<h2>
<a name="todo" class="anchor" href="#todo"><span class="octicon octicon-link"></span></a>TODO</h2>

<ul>
<li>UCB with extensions for delayed rewards</li>
<li>Sticky assignements</li>
</ul><h1>
<a name="credits" class="anchor" href="#credits"><span class="octicon octicon-link"></span></a>Credits</h1>

<p>Developed by</p>

<ul>
<li>Rany Keddo (<a href="https://github.com/purzelrakete" class="user-mention">@purzelrakete</a>)</li>
</ul><p>Thanks to for advice and opinions to</p>

<ul>
<li>John Myles White</li>
<li>Josh Devins</li>
<li>Ozg√ºr Demir</li>
<li>Peter Bourgon</li>
<li>Sean Braithwaite</li>
</ul>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/purzelrakete/bandit/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/purzelrakete/bandit/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/purzelrakete/bandit"></a> is maintained by <a href="https://github.com/purzelrakete">purzelrakete</a>.</p>

          <p>This page was generated by <a href="pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>